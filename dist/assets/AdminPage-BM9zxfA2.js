import{j as e,r as f,R as Oe}from"./index-484102pf.js";import{u as O,a as Z,b as Y,c as Ze,C as Je}from"./Canvas-CQjE2HQd.js";import{s as B,r as D,d as W,a as Ve}from"./PasswordGate-DEJYhbL0.js";const me=t=>t.trim()?t.split(`
`).filter(s=>s.trim()!=="").map(s=>s.split("	")):[],he=["#000000","#ffffff","#cccccc","#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffa500","#800080"],Ge=[{id:"select",label:"ì„ íƒ",icon:"ðŸ‘†"},{id:"text",label:"í…ìŠ¤íŠ¸",icon:"ðŸ“"},{id:"checkbox",label:"ì²´í¬",icon:"â˜‘ï¸"},{id:"image",label:"ì´ë¯¸ì§€",icon:"ðŸ–¼ï¸"},{id:"pen",label:"í•„ê¸°",icon:"âœï¸"},{id:"eraser",label:"ì§€ìš°ê°œ",icon:"ðŸ§½"}],H=t=>t&&typeof t.hasCheckbox<"u",Ue=t=>t&&typeof t.src<"u",Xe=t=>t&&"cellType"in t&&t.cellType==="cell",be=(t,n)=>{var s,r,l;if(!t||!H(t))return"#000000";switch(n){case"text":return((s=t.textStyle)==null?void 0:s.color)||"#000000";case"background":return((r=t.boxStyle)==null?void 0:r.backgroundColor)||"transparent";case"border":return((l=t.boxStyle)==null?void 0:l.borderColor)||"#000000";default:return"#000000"}},_e=(t,n)=>{const s=[...t,...n];return Math.max(...s.map(r=>r.zIndex||0))},Ke=(t,n)=>{const s=[...t,...n];return Math.min(...s.map(r=>r.zIndex||0))},Ye=(t,n,s)=>{const l=[...n,...s].filter(m=>(m.zIndex||0)>t);return l.length===0?null:Math.min(...l.map(m=>m.zIndex||0))},qe=(t,n,s)=>{const l=[...n,...s].filter(m=>(m.zIndex||0)<t);return l.length===0?null:Math.max(...l.map(m=>m.zIndex||0))},ue=t=>{const n=me(t);if(n.length===0)return{rows:0,cols:0};const s=n.length,r=Math.max(...n.map(l=>l.length));return{rows:s,cols:r}},Qe=t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable||t.closest("input, textarea, [contenteditable]")!==null,et=t=>t.hasAttribute("data-canvas-container")||t.tabIndex===0&&t.tagName==="DIV",tt=({currentTool:t,onToolSelect:n,onCreateText:s,onCreateCheckbox:r,onCreateImage:l})=>{const m=d=>{switch(d){case"select":n("select");break;case"text":s();break;case"checkbox":r();break;case"image":l();break;case"pen":case"eraser":n(d);break}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"âš¡"})," ë©”ì¸ ë„êµ¬"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ge.map(d=>e.jsxs("button",{onClick:()=>m(d.id),className:`p-3 rounded-lg flex flex-col items-center gap-1 transition-all duration-200 border-2
              ${t===d.id?"bg-blue-500 text-white border-blue-600 shadow-lg scale-105":"bg-slate-50 hover:bg-slate-100 text-slate-700 border-slate-200 hover:border-slate-300"}`,children:[e.jsx("span",{className:"text-2xl",children:d.icon}),e.jsx("span",{className:"text-xs font-medium",children:d.label})]},d.id))})]})},st=({isExpanded:t,onToggle:n,excelPasteData:s,showPreview:r,safeSettings:l,onDataChange:m,onPreviewToggle:d,onCreateCells:j,onDeleteCellGroups:v,updateSettings:g})=>{const h=ue(s),a=o=>{m(o);const i=new CustomEvent("excel-preview-update",{detail:{data:o,show:!!o.trim()}});window.dispatchEvent(i)};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("button",{onClick:n,className:"w-full p-4 flex items-center justify-between text-sm font-bold text-slate-700 hover:bg-slate-50 rounded-t-xl transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," ì—‘ì…€ ë°ì´í„° ìž…ë ¥"]}),e.jsx("span",{className:`text-slate-400 transition-transform duration-200 ${t?"rotate-180":""}`,children:"â–¼"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-200 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ë°ì´í„° ë¶™ì—¬ë„£ê¸°"}),e.jsx("textarea",{value:s,onChange:o=>a(o.target.value),onFocus:o=>o.stopPropagation(),onClick:o=>o.stopPropagation(),placeholder:"ì—‘ì…€ì—ì„œ ë³µì‚¬í•œ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-xs resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s?`${h.rows}í–‰ Ã— ${h.cols}ì—´`:"ë°ì´í„° ì—†ìŒ"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"X ì¢Œí‘œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,x:Math.max(0,l.admin.excelPasteSettings.startPosition.x-10)}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"â—€"}),e.jsx("input",{type:"number",value:l.admin.excelPasteSettings.startPosition.x,onChange:o=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,x:parseInt(o.target.value)||0}}}),onFocus:o=>o.stopPropagation(),onClick:o=>o.stopPropagation(),className:"w-16 px-1 py-1 border border-slate-300 rounded text-xs text-center"}),e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,x:l.admin.excelPasteSettings.startPosition.x+10}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"â–¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"Y ì¢Œí‘œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,y:Math.max(0,l.admin.excelPasteSettings.startPosition.y-10)}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"â–²"}),e.jsx("input",{type:"number",value:l.admin.excelPasteSettings.startPosition.y,onChange:o=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,y:parseInt(o.target.value)||0}}}),onFocus:o=>o.stopPropagation(),onClick:o=>o.stopPropagation(),className:"w-16 px-1 py-1 border border-slate-300 rounded text-xs text-center"}),e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,startPosition:{...l.admin.excelPasteSettings.startPosition,y:l.admin.excelPasteSettings.startPosition.y+10}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"â–¼"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"ì…€ ë„ˆë¹„"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,cellWidth:Math.max(20,l.admin.excelPasteSettings.cellWidth-1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â—€"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[l.admin.excelPasteSettings.cellWidth,"px"]}),e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,cellWidth:Math.min(300,l.admin.excelPasteSettings.cellWidth+1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"ì…€ ë†’ì´"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,cellHeight:Math.max(20,l.admin.excelPasteSettings.cellHeight-1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–²"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[l.admin.excelPasteSettings.cellHeight,"px"]}),e.jsx("button",{onClick:()=>g("admin",{excelPasteSettings:{...l.admin.excelPasteSettings,cellHeight:Math.min(100,l.admin.excelPasteSettings.cellHeight+1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¼"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:!s.trim(),className:"flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white rounded-lg text-sm font-medium transition-colors",children:"ðŸ“‹ ì…€ ìƒì„±"}),e.jsxs("button",{onClick:d,disabled:!s.trim(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white rounded-lg text-sm font-medium transition-colors",children:["ðŸ‘ï¸ ",r?"ìˆ¨ê¹€":"ë¯¸ë¦¬ë³´ê¸°"]})]}),e.jsx("button",{onClick:v,className:"w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",title:"ìƒì„±ëœ ëª¨ë“  ì—‘ì…€ ì…€ ê·¸ë£¹ì„ ì‚­ì œí•©ë‹ˆë‹¤",children:"ðŸ—‘ï¸ ì—‘ì…€ ì…€ ê·¸ë£¹ ì‚­ì œ"})]})]})]})},at=({colorMode:t,currentColor:n,onColorModeChange:s,onColorSelect:r,showTransparent:l=!1})=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ìƒ‰ìƒ"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-3",children:[e.jsx("button",{onClick:()=>s("text"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="text"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"í…ìŠ¤íŠ¸"}),e.jsx("button",{onClick:()=>s("background"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="background"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"ë°°ê²½"}),e.jsx("button",{onClick:()=>s("border"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="border"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"í…Œë‘ë¦¬"})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[l&&e.jsx("button",{onClick:()=>r("transparent"),className:`w-8 h-8 rounded border-2 transition-all ${n==="transparent"?"border-blue-500 border-2 shadow-md":"border-slate-300 hover:border-slate-400"}`,style:{backgroundColor:"white",backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"8px 8px",backgroundPosition:"0 0, 0 4px, 4px -4px, -4px 0px"},title:"íˆ¬ëª…"}),he.map((m,d)=>{const j=n===m;return e.jsx("button",{onClick:()=>r(m),className:`w-8 h-8 rounded border-2 transition-all ${j?"border-blue-500 border-2 shadow-md":"border-slate-300 hover:border-slate-400"}`,style:{backgroundColor:m},title:m},d)})]})]}),nt=({onDuplicate:t,onDelete:n,onBringToFront:s,onBringForward:r,onSendBackward:l,onSendToBack:m})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,className:"flex-1 px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-medium transition-colors",children:"ðŸ“‹ ë³µì‚¬"}),e.jsx("button",{onClick:n,className:"flex-1 px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors",children:"ðŸ—‘ï¸ ì‚­ì œ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ë ˆì´ì–´ ìˆœì„œ"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("button",{onClick:s,className:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs font-medium transition-colors",title:"ë§¨ ìœ„ë¡œ",children:"â¬†â¬†"}),e.jsx("button",{onClick:r,className:"px-2 py-1 bg-blue-400 hover:bg-blue-500 text-white rounded text-xs font-medium transition-colors",title:"ìœ„ë¡œ",children:"â¬†"}),e.jsx("button",{onClick:l,className:"px-2 py-1 bg-purple-400 hover:bg-purple-500 text-white rounded text-xs font-medium transition-colors",title:"ì•„ëž˜ë¡œ",children:"â¬‡"}),e.jsx("button",{onClick:m,className:"px-2 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium transition-colors",title:"ë§¨ ì•„ëž˜ë¡œ",children:"â¬‡â¬‡"})]})]})]}),lt=({selectedObject:t,colorMode:n,onColorModeChange:s,onColorSelect:r,onUpdateTextObject:l,onUpdateImageObject:m,onDuplicate:d,onDelete:j,onBringToFront:v,onBringForward:g,onSendBackward:h,onSendToBack:a,getCurrentColor:o})=>{var A,b,k;if(!t)return null;const i=o(),x=c=>{if(H(t)){const y=t.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};l(t.id,{textStyle:{...y,...c}})}},N=c=>{if(H(t)){const y=t.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};l(t.id,{boxStyle:{...y,...c}})}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"âœï¸"})," ì„ íƒëœ ê°ì²´ íŽ¸ì§‘"]}),H(t)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"í…ìŠ¤íŠ¸"}),e.jsx("textarea",{value:t.text,onChange:c=>l(t.id,{text:c.target.value}),onFocus:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"í°íŠ¸ í¬ê¸°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(t.id,{fontSize:Math.max(8,t.fontSize-2)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded border",children:[t.fontSize,"px"]}),e.jsx("button",{onClick:()=>l(t.id,{fontSize:Math.min(72,t.fontSize+2)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–²"})]})]}),e.jsx(at,{colorMode:n,currentColor:i,onColorModeChange:s,onColorSelect:r,showTransparent:n==="background"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{var c;return x({bold:!((c=t.textStyle)!=null&&c.bold)})},className:`px-3 py-1 rounded-lg text-xs transition-colors ${(A=t.textStyle)!=null&&A.bold?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"êµµê²Œ"}),e.jsx("button",{onClick:()=>{var c;return x({italic:!((c=t.textStyle)!=null&&c.italic)})},className:`px-3 py-1 rounded-lg text-xs transition-colors ${(b=t.textStyle)!=null&&b.italic?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"ê¸°ìš¸ìž„"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"í…ìŠ¤íŠ¸ ì •ë ¬"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"ê°€ë¡œ"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["left","center","right"].map(c=>{var y;return e.jsx("button",{onClick:()=>x({horizontalAlign:c}),className:`px-2 py-1 rounded text-xs transition-colors ${((y=t.textStyle)==null?void 0:y.horizontalAlign)===c?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:c==="left"?"â—€":c==="center"?"â—":"â–¶"},c)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"ì„¸ë¡œ"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["top","middle","bottom"].map(c=>{var y;return e.jsx("button",{onClick:()=>x({verticalAlign:c}),className:`px-2 py-1 rounded text-xs transition-colors ${((y=t.textStyle)==null?void 0:y.verticalAlign)===c?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:c==="top"?"â–²":c==="middle"?"â—":"â–¼"},c)})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"í…Œë‘ë¦¬ ë‘ê»˜"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{var c;return N({borderWidth:Math.max(0,(((c=t.boxStyle)==null?void 0:c.borderWidth)||0)-1)})},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[((k=t.boxStyle)==null?void 0:k.borderWidth)||0,"px"]}),e.jsx("button",{onClick:()=>{var c;return N({borderWidth:Math.min(10,(((c=t.boxStyle)==null?void 0:c.borderWidth)||0)+1)})},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–²"})]})]})]}),Ue(t)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:t.maintainAspectRatio||!1,onChange:c=>m(t.id,{maintainAspectRatio:c.target.checked}),className:"rounded"}),e.jsx("span",{children:"ë¹„ìœ¨ ìœ ì§€"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"ë¶ˆíˆ¬ëª…ë„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(t.id,{opacity:Math.max(.1,(t.opacity||1)-.1)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[Math.round((t.opacity||1)*100),"%"]}),e.jsx("button",{onClick:()=>m(t.id,{opacity:Math.min(1,(t.opacity||1)+.1)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–²"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"í¬ê¸°"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 mb-1 block",children:"ë„ˆë¹„"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const c=Math.max(50,t.width-10),y=t.maintainAspectRatio?{width:c,height:c/(t.width/t.height)}:{width:c};m(t.id,y)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â—€"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-slate-50 py-1 rounded",children:Math.round(t.width)}),e.jsx("button",{onClick:()=>{const c=t.width+10,y=t.maintainAspectRatio?{width:c,height:c/(t.width/t.height)}:{width:c};m(t.id,y)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 mb-1 block",children:"ë†’ì´"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const c=Math.max(30,t.height-10),y=t.maintainAspectRatio?{height:c,width:c*(t.width/t.height)}:{height:c};m(t.id,y)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–²"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-slate-50 py-1 rounded",children:Math.round(t.height)}),e.jsx("button",{onClick:()=>{const c=t.height+10,y=t.maintainAspectRatio?{height:c,width:c*(t.width/t.height)}:{height:c};m(t.id,y)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"â–¼"})]})]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-slate-200",children:e.jsx(nt,{onDuplicate:d,onDelete:j,onBringToFront:v,onBringForward:g,onSendBackward:h,onSendToBack:a})})]})},rt=({textObjects:t,colorMode:n,onColorModeChange:s,onUpdateTextObject:r,clearCellSelection:l})=>{const m=O(h=>Array.from(h.selectedCellIds)),d=O(h=>h.selectedCellIds.size),j=O(h=>h.clearSelection);if(d===0)return null;const v=()=>{let h=72;for(const a of m){const o=t.find(i=>i.id===a);o&&o.cellType==="cell"&&(h=Math.min(h,o.fontSize||16))}return h===72?16:h},g=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#008000","#000080","#800000","#008080","#C0C0C0","#FFFFE0","#F0F8FF"];return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," ì„ íƒëœ ì—‘ì…€ ì…€ (",d,"ê°œ)"]}),e.jsx("button",{onClick:()=>{j(),l()},className:"text-xs text-slate-500 hover:text-slate-700 bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded transition-colors",children:"ì„ íƒ í•´ì œ"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:["í°íŠ¸ í¬ê¸° (ê°€ìž¥ ìž‘ì€ í¬ê¸°: ",v(),"px ê¸°ì¤€)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const h=v(),a=Math.max(8,h-2),o=m.map(async i=>{const x=t.find(N=>N.id===i);if(x&&x.cellType==="cell")return r(i,{fontSize:a})});try{await Promise.all(o.filter(i=>i!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ í°íŠ¸ í¬ê¸°ë¥¼ ${a}pxë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(i){console.error("âŒ í°íŠ¸ í¬ê¸° ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",i)}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",title:`í°íŠ¸ í¬ê¸° ê°ì†Œ (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded border",children:[v(),"px â†’ ì¼ê´„ë³€ê²½"]}),e.jsx("button",{onClick:async()=>{const h=v(),a=Math.min(72,h+2),o=m.map(async i=>{const x=t.find(N=>N.id===i);if(x&&x.cellType==="cell")return r(i,{fontSize:a})});try{await Promise.all(o.filter(i=>i!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ í°íŠ¸ í¬ê¸°ë¥¼ ${a}pxë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(i){console.error("âŒ í°íŠ¸ í¬ê¸° ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",i)}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",title:`í°íŠ¸ í¬ê¸° ì¦ê°€ (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:"â–²"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ìƒ‰ìƒ"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-3",children:[e.jsx("button",{onClick:()=>s("text"),className:`px-2 py-2 rounded text-xs transition-colors ${n==="text"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"í…ìŠ¤íŠ¸"}),e.jsx("button",{onClick:()=>s("background"),className:`px-2 py-2 rounded text-xs transition-colors ${n==="background"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"ë°°ê²½"}),e.jsx("button",{onClick:()=>s("border"),className:`px-2 py-2 rounded text-xs transition-colors ${n==="border"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"í…Œë‘ë¦¬"})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[n==="background"&&e.jsx("button",{onClick:async()=>{const h=m.map(async a=>{const o=t.find(i=>i.id===a);if(o&&o.cellType==="cell"){const i=o.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};return r(a,{boxStyle:{...i,backgroundColor:"transparent"}})}});try{await Promise.all(h.filter(a=>a!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ ë°°ê²½ì„ íˆ¬ëª…ìœ¼ë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(a){console.error("âŒ íˆ¬ëª… ë°°ê²½ ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",a)}},className:"w-8 h-8 rounded border-2 border-gray-300 bg-white flex items-center justify-center hover:bg-gray-50 transition-colors cursor-pointer",title:`íˆ¬ëª… (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:e.jsx("span",{className:"text-red-500 text-xs",children:"âˆ…"})}),g.map(h=>e.jsx("button",{onClick:async()=>{const a=m.map(async o=>{const i=t.find(x=>x.id===o);if(i&&i.cellType==="cell"){if(n==="text"){const x=i.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};return r(o,{textStyle:{...x,color:h}})}else if(n==="background"){const x=i.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};return r(o,{boxStyle:{...x,backgroundColor:h}})}else if(n==="border"){const x=i.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};return r(o,{boxStyle:{...x,borderColor:h,borderWidth:1}})}}});try{await Promise.all(a.filter(o=>o!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ ${n==="text"?"í…ìŠ¤íŠ¸":n==="background"?"ë°°ê²½":"í…Œë‘ë¦¬"} ìƒ‰ìƒì„ ${h}ë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(o){console.error("âŒ ìƒ‰ìƒ ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",o)}},className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform cursor-pointer",style:{backgroundColor:h},title:`${h} (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`},h))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{const h=m.map(async a=>{const o=t.find(i=>i.id===a);if(o&&o.cellType==="cell"){const i=o.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};return r(a,{textStyle:{...i,bold:!i.bold}})}});try{await Promise.all(h.filter(a=>a!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ êµµê²Œ ìŠ¤íƒ€ì¼ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(a){console.error("âŒ êµµê²Œ ìŠ¤íƒ€ì¼ ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",a)}},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded text-xs font-bold transition-colors",title:`êµµê²Œ (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:"B"}),e.jsx("button",{onClick:async()=>{const h=m.map(async a=>{const o=t.find(i=>i.id===a);if(o&&o.cellType==="cell"){const i=o.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};return r(a,{textStyle:{...i,italic:!i.italic}})}});try{await Promise.all(h.filter(a=>a!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ ê¸°ìš¸ìž„ ìŠ¤íƒ€ì¼ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(a){console.error("âŒ ê¸°ìš¸ìž„ ìŠ¤íƒ€ì¼ ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",a)}},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded text-xs italic transition-colors",title:`ê¸°ìš¸ìž„ (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:"I"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ì •ë ¬"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:["left","center","right"].map(h=>e.jsx("button",{onClick:async()=>{const a=m.map(async o=>{const i=t.find(x=>x.id===o);if(i&&i.cellType==="cell"){const x=i.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};return r(o,{textStyle:{...x,horizontalAlign:h}})}});try{await Promise.all(a.filter(o=>o!==void 0)),console.log(`âœ… ${d}ê°œ ì…€ì˜ ìˆ˜í‰ì •ë ¬ì„ ${h}ë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ`)}catch(o){console.error("âŒ ìˆ˜í‰ì •ë ¬ ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",o)}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",title:`${h==="left"?"ì™¼ìª½":h==="center"?"ê°€ìš´ë°":"ì˜¤ë¥¸ìª½"} ì •ë ¬ (${d}ê°œ ì…€ ì¼ê´„ ë³€ê²½)`,children:h==="left"?"â†":h==="center"?"â†”":"â†’"},h))}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["top","middle","bottom"].map(h=>e.jsx("button",{onClick:async()=>{for(const a of m){const o=t.find(i=>i.id===a);if(o&&o.cellType==="cell"){const i=o.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await r(a,{textStyle:{...i,verticalAlign:h}})}}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",children:h==="top"?"â†‘":h==="middle"?"â†•":"â†“"},h))})]})]})]})},ot=({isExpanded:t,onToggle:n,textObjects:s,imageObjects:r,drawObjects:l,floorImage:m,settings:d,initializeFirebaseListeners:j})=>{const v=f.useRef(null),g=()=>{try{const i={textObjects:s,imageObjects:r,drawObjects:l,floorImage:m,settings:d,exportedAt:new Date().toISOString(),version:"1.0"},x=JSON.stringify(i,null,2),N=new Blob([x],{type:"application/json"}),k=`board7-backup-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,c=document.createElement("a");c.href=URL.createObjectURL(N),c.download=k,c.click(),URL.revokeObjectURL(c.href),alert(`âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤!
íŒŒì¼ëª…: ${k}`)}catch(i){console.error("ë°ì´í„° ì €ìž¥ ì˜¤ë¥˜:",i),alert("âŒ ë°ì´í„° ì €ìž¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},h=()=>{var i;(i=v.current)==null||i.click()},a=i=>{var b;const x=(b=i.target.files)==null?void 0:b[0];if(!x)return;if(!x.name.endsWith(".json")){alert("âŒ JSON íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");return}const N=`âš ï¸ ê²½ê³ : í˜„ìž¬ ìº”ë²„ìŠ¤ì˜ ëª¨ë“  ê°ì²´ì™€ ê·¸ë¦¬ê¸° ìš”ì†Œê°€ ì‚­ì œë©ë‹ˆë‹¤!

í˜„ìž¬ ë°ì´í„°:
â€¢ í…ìŠ¤íŠ¸ ê°ì²´: ${s.length}ê°œ
â€¢ ì´ë¯¸ì§€ ê°ì²´: ${r.length}ê°œ  
â€¢ ê·¸ë¦¬ê¸° ìš”ì†Œ: ${l.length}ê°œ
â€¢ ë°°ê²½ ì´ë¯¸ì§€: ${m?"ìžˆìŒ":"ì—†ìŒ"}

ì •ë§ë¡œ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`;if(!confirm(N)){i.target.value="";return}const A=new FileReader;A.onload=async k=>{var c,y,R,$;try{const T=(c=k.target)==null?void 0:c.result,F=JSON.parse(T);if(!F.version||!F.exportedAt)throw new Error("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ í˜•ì‹ìž…ë‹ˆë‹¤.");await o(F),alert(`âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤!

ë¶ˆëŸ¬ì˜¨ ë°ì´í„°:
â€¢ í…ìŠ¤íŠ¸ ê°ì²´: ${((y=F.textObjects)==null?void 0:y.length)||0}ê°œ
â€¢ ì´ë¯¸ì§€ ê°ì²´: ${((R=F.imageObjects)==null?void 0:R.length)||0}ê°œ
â€¢ ê·¸ë¦¬ê¸° ìš”ì†Œ: ${(($=F.drawObjects)==null?void 0:$.length)||0}ê°œ
â€¢ ë°°ê²½ ì´ë¯¸ì§€: ${F.floorImage?"ìžˆìŒ":"ì—†ìŒ"}
â€¢ ë°±ì—… ìƒì„±ì¼: ${new Date(F.exportedAt).toLocaleString()}`)}catch(T){console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:",T),alert(`âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
íŒŒì¼ì´ ì†ìƒë˜ì—ˆê±°ë‚˜ ì˜¬ë°”ë¥´ì§€ ì•Šì€ í˜•ì‹ìž…ë‹ˆë‹¤.`)}i.target.value=""},A.readAsText(x)},o=async i=>{var x,N,A;try{await Promise.all([B(D(W,"textObjects"),null),B(D(W,"imageObjects"),null),B(D(W,"drawObjects"),null),B(D(W,"floorImage"),null)]);const b=[];if(((x=i.textObjects)==null?void 0:x.length)>0){const k=i.textObjects.reduce((c,y)=>(c[y.id]=y,c),{});b.push(B(D(W,"textObjects"),k))}if(((N=i.imageObjects)==null?void 0:N.length)>0){const k=i.imageObjects.reduce((c,y)=>(c[y.id]=y,c),{});b.push(B(D(W,"imageObjects"),k))}if(((A=i.drawObjects)==null?void 0:A.length)>0){const k=i.drawObjects.reduce((c,y)=>(c[y.id]=y,c),{});b.push(B(D(W,"drawObjects"),k))}i.floorImage&&b.push(B(D(W,"floorImage"),i.floorImage)),i.settings&&b.push(B(D(W,"settings"),i.settings)),await Promise.all(b),setTimeout(()=>{j()},500)}catch(b){throw console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:",b),b}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("button",{onClick:n,className:"w-full p-4 flex items-center justify-between text-sm font-bold text-slate-700 hover:bg-slate-50 rounded-t-xl transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¾"})," ë°ì´í„° ê´€ë¦¬"]}),e.jsx("span",{className:`text-slate-400 transition-transform duration-200 ${t?"rotate-180":""}`,children:"â–¼"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-200 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-2",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“Š"})," í˜„ìž¬ ë°ì´í„° í˜„í™©"]}),e.jsxs("div",{className:"text-xs text-slate-600 space-y-1",children:[e.jsxs("div",{children:["â€¢ í…ìŠ¤íŠ¸ ê°ì²´: ",e.jsxs("span",{className:"font-medium",children:[s.length,"ê°œ"]})]}),e.jsxs("div",{children:["â€¢ ì´ë¯¸ì§€ ê°ì²´: ",e.jsxs("span",{className:"font-medium",children:[r.length,"ê°œ"]})]}),e.jsxs("div",{children:["â€¢ ê·¸ë¦¬ê¸° ìš”ì†Œ: ",e.jsxs("span",{className:"font-medium",children:[l.length,"ê°œ"]})]}),e.jsxs("div",{children:["â€¢ ë°°ê²½ ì´ë¯¸ì§€: ",e.jsx("span",{className:"font-medium",children:m?"ìžˆìŒ":"ì—†ìŒ"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:g,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm",children:[e.jsx("span",{children:"ðŸ’¾"}),"ë°ì´í„° ì €ìž¥ (JSON ë‹¤ìš´ë¡œë“œ)"]}),e.jsxs("button",{onClick:h,className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm",children:[e.jsx("span",{children:"ðŸ“‚"}),"ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (JSON ì—…ë¡œë“œ)"]}),e.jsx("input",{ref:v,type:"file",accept:".json",onChange:a,className:"hidden"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsxs("h5",{className:"text-xs font-bold text-yellow-700 mb-2 flex items-center gap-1",children:[e.jsx("span",{children:"âš ï¸"})," ì£¼ì˜ì‚¬í•­"]}),e.jsxs("div",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("div",{children:"â€¢ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œ í˜„ìž¬ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤"}),e.jsx("div",{children:"â€¢ ì €ìž¥ëœ JSON íŒŒì¼ì€ ì˜¤í”„ë¼ì¸ì—ì„œ ë³´ê´€ë©ë‹ˆë‹¤"}),e.jsx("div",{children:"â€¢ ë°±ì—…ì„ ì •ê¸°ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì„ ê¶Œìž¥í•©ë‹ˆë‹¤"})]})]})]})]})},it=({isExpanded:t,onToggle:n,safeSettings:s,updateSettings:r,onImageUpload:l})=>{const{updatePassword:m}=Z(),[d,j]=f.useState(null),[v,g]=f.useState(""),[h,a]=f.useState(""),o=async x=>{if(v.length!==4||!/^\d{4}$/.test(v)){alert("íŒ¨ìŠ¤ì›Œë“œëŠ” 4ìžë¦¬ ìˆ«ìžì—¬ì•¼ í•©ë‹ˆë‹¤.");return}if(v!==h){alert("íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");return}try{await m(x,v),alert(`${x==="admin"?"ê´€ë¦¬ìž":"ë·°ì–´"} íŒ¨ìŠ¤ì›Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`),j(null),g(""),a("")}catch(N){alert(`íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ì‹¤íŒ¨: ${N.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}},i=()=>{j(null),g(""),a("")};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("button",{onClick:n,className:"w-full p-4 flex items-center justify-between text-sm font-bold text-slate-700 hover:bg-slate-50 rounded-t-xl transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"âš™ï¸"})," ì„¤ì •"]}),e.jsx("span",{className:`text-slate-400 transition-transform duration-200 ${t?"rotate-180":""}`,children:"â–¼"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-200 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ”²"})," ê·¸ë¦¬ë“œ"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.gridVisible,onChange:x=>r("admin",{gridVisible:x.target.checked}),className:"rounded"}),e.jsx("span",{children:"ê·¸ë¦¬ë“œ í‘œì‹œ"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.gridSnapEnabled,onChange:x=>r("admin",{gridSnapEnabled:x.target.checked}),className:"rounded"}),e.jsx("span",{children:"ê·¸ë¦¬ë“œì— ìŠ¤ëƒ…"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"ê·¸ë¦¬ë“œ í¬ê¸°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r("admin",{gridSize:Math.max(8,s.admin.gridSize-4)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-white py-1 rounded border",children:[s.admin.gridSize,"px"]}),e.jsx("button",{onClick:()=>r("admin",{gridSize:Math.min(64,s.admin.gridSize+4)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–²"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“"})," ê°ì²´ ìƒì„± ìœ„ì¹˜"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"X ì¢Œí‘œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const x=Math.max(0,s.admin.objectCreationPosition.x-20);r("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,x}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â—€"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:s.admin.objectCreationPosition.x}),e.jsx("button",{onClick:()=>{const x=s.admin.objectCreationPosition.x+20;r("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,x}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"Y ì¢Œí‘œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const x=Math.max(0,s.admin.objectCreationPosition.y-20);r("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,y:x}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–²"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:s.admin.objectCreationPosition.y}),e.jsx("button",{onClick:()=>{const x=s.admin.objectCreationPosition.y+20;r("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,y:x}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¼"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ–¼ï¸"})," ë°°ê²½ ì´ë¯¸ì§€"]}),e.jsxs("label",{className:"w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors cursor-pointer text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ“"}),e.jsx("span",{children:"ì´ë¯¸ì§€ ì—…ë¡œë“œ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:l,className:"hidden"})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 mb-3 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ”"})," íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½"]}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-600 font-medium",children:[d==="admin"?"ê´€ë¦¬ìž":"ë·°ì–´"," íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"ìƒˆ íŒ¨ìŠ¤ì›Œë“œ (4ìžë¦¬ ìˆ«ìž)"}),e.jsx("input",{type:"password",value:v,onChange:x=>g(x.target.value),maxLength:4,pattern:"\\d{4}",className:"w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ìƒˆ íŒ¨ìŠ¤ì›Œë“œ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"íŒ¨ìŠ¤ì›Œë“œ í™•ì¸"}),e.jsx("input",{type:"password",value:h,onChange:x=>a(x.target.value),maxLength:4,pattern:"\\d{4}",className:"w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"íŒ¨ìŠ¤ì›Œë“œ í™•ì¸"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(d),className:"flex-1 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium rounded-lg transition-colors",children:"ë³€ê²½"}),e.jsx("button",{onClick:i,className:"flex-1 px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white text-xs font-medium rounded-lg transition-colors",children:"ì·¨ì†Œ"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>j("admin"),className:"w-full px-3 py-2 bg-red-500 hover:bg-red-600 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ‘‘"}),e.jsx("span",{children:"ê´€ë¦¬ìž íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½"})]}),e.jsxs("button",{onClick:()=>j("view"),className:"w-full px-3 py-2 bg-green-500 hover:bg-green-600 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ‘ï¸"}),e.jsx("span",{children:"ë·°ì–´ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-2",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ”§"})," ê¸°íƒ€"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.autoToolSwitch,onChange:x=>r("admin",{autoToolSwitch:x.target.checked}),className:"rounded"}),e.jsx("span",{children:"ê°ì²´ ìƒì„± í›„ ìžë™ìœ¼ë¡œ ì„ íƒ ë„êµ¬ë¡œ ì „í™˜"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"ê¸°ë³¸ í°íŠ¸ í¬ê¸°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r("admin",{defaultFontSize:Math.max(8,s.admin.defaultFontSize-2)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-white py-1 rounded border",children:[s.admin.defaultFontSize,"px"]}),e.jsx("button",{onClick:()=>r("admin",{defaultFontSize:Math.min(72,s.admin.defaultFontSize+2)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–²"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"ê¸°ë³¸ ë°•ìŠ¤ í¬ê¸°"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"ê°€ë¡œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{defaultBoxWidth:Math.max(50,s.admin.defaultBoxWidth-10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â—€"}),e.jsxs("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:[s.admin.defaultBoxWidth,"px"]}),e.jsx("button",{onClick:()=>r("admin",{defaultBoxWidth:Math.min(500,s.admin.defaultBoxWidth+10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"ì„¸ë¡œ"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{defaultBoxHeight:Math.max(30,s.admin.defaultBoxHeight-10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–²"}),e.jsxs("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:[s.admin.defaultBoxHeight,"px"]}),e.jsx("button",{onClick:()=>r("admin",{defaultBoxHeight:Math.min(200,s.admin.defaultBoxHeight+10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"â–¼"})]})]})]})]})]})]})]})},ct=()=>{const[t,n]=f.useState(!1),[s,r]=f.useState(!1),[l,m]=f.useState(!1),[d,j]=f.useState(""),[v,g]=f.useState(!1),[h,a]=f.useState("text"),o=f.useRef(null);return{isSettingsExpanded:t,isExcelPasteExpanded:s,isDataManagementExpanded:l,excelPasteData:d,showPreview:v,colorMode:h,updateTimerRef:o,setIsSettingsExpanded:n,setIsExcelPasteExpanded:r,setIsDataManagementExpanded:m,setExcelPasteData:j,setShowPreview:g,setColorMode:a,toggleSettings:()=>n(!t),toggleExcelPaste:()=>r(!s),toggleDataManagement:()=>m(!l),resetExcelData:()=>{j(""),g(!1)},clearUpdateTimer:()=>{o.current&&(clearTimeout(o.current),o.current=null)}}},dt=({selectedObject:t,colorMode:n,updateTextStyle:s,updateBoxStyle:r})=>{const l=f.useCallback(d=>{if(!(!t||!H(t)))switch(n){case"text":s({color:d});break;case"background":r({backgroundColor:d});break;case"border":r({borderColor:d});break}},[n,t,s,r]),m=be(t,n);return{colors:he,currentColor:m,handleColorSelect:l,showTransparent:n==="background"}},xe=t=>new Promise((n,s)=>{const r=new FileReader;r.onload=l=>{var d;const m=(d=l.target)==null?void 0:d.result;n(m)},r.onerror=()=>{s(new Error("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨"))},r.readAsDataURL(t)}),xt=t=>new Promise((n,s)=>{const r=new Image;r.onload=()=>{n({width:r.naturalWidth,height:r.naturalHeight})},r.onerror=()=>{s(new Error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨"))},r.src=t}),mt=(t="image/*")=>new Promise(n=>{const s=document.createElement("input");s.type="file",s.accept=t,s.onchange=r=>{var m;const l=(m=r.target.files)==null?void 0:m[0];n(l||null)},s.click()}),ht=(t,n,s=200)=>{const r=n/t,l=s*r;return{width:s,height:l}},K=(t,n)=>{const s=new CustomEvent("excel-preview-update",{detail:{data:t,show:n}});window.dispatchEvent(s)},bt=({excelPasteData:t,showPreview:n,safeSettings:s,textObjects:r,addTextObject:l,deleteTextObject:m,onDataChange:d,onPreviewChange:j})=>{const v=ue(t),g=f.useCallback(async()=>{var L;const a=me(t);if(a.length===0){alert("ë¶™ì—¬ë„£ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");return}const{startPosition:o,cellWidth:i,cellHeight:x,fontSize:N,fontColor:A,backgroundColor:b,maxRows:k=100,maxCols:c=50}=s.admin.excelPasteSettings,y=`excel-input-${Date.now()}`,R=[],$=Math.min(a.length,k),T=a.map(S=>S.length),F=T.length>0?Math.max(...T):0,I=Math.min(F,c);for(let S=0;S<$;S++)for(let M=0;M<I;M++){const J=((L=a[S])==null?void 0:L[M])||"",V={x:o.x+M*i,y:o.y+S*x,width:i,height:x,text:J,fontSize:N,textStyle:{color:A,bold:!1,italic:!1,horizontalAlign:"center",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:b,backgroundOpacity:1,borderColor:"#d1d5db",borderWidth:1,borderRadius:0},permissions:{editable:!0,movable:!1,resizable:!1,deletable:!1},zIndex:Date.now()+S*I+M,locked:!0,visible:!0,opacity:1,hasCheckbox:!1,checkboxChecked:!1,checkboxCheckedColor:"#22c55e",checkboxUncheckedColor:"#f3f4f6",isEditing:!1,lastModified:Date.now(),groupId:y,cellType:"cell",cellPosition:{row:S,col:M}};R.push(V)}try{for(const S of R)await l(S);alert(`${$}x${I} ì…€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`),d(""),j(!1),K("",!1)}catch(S){console.error("ì—‘ì…€ ì…€ ìƒì„± ì‹¤íŒ¨:",S),alert("ì…€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[t,s.admin.excelPasteSettings,l,d,j]),h=f.useCallback(async()=>{const a=r.filter(x=>x.groupId&&x.groupId.startsWith("excel-input-"));if(a.length===0){alert("ì‚­ì œí•  ì—‘ì…€ ì…€ì´ ì—†ìŠµë‹ˆë‹¤.");return}const o=new Set(a.map(x=>x.groupId)).size,i=`${o}ê°œì˜ ì—‘ì…€ ê·¸ë£¹ (ì´ ${a.length}ê°œ ì…€)ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;if(confirm(i))try{for(const x of a)await m(x.id);alert(`${o}ê°œ ê·¸ë£¹ (${a.length}ê°œ ì…€)ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(x){console.error("ì—‘ì…€ ì…€ ì‚­ì œ ì‹¤íŒ¨:",x),alert("ì…€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[r,m]);return f.useEffect(()=>{n&&t.trim()?K(t,!0):K("",!1)},[n,t,s.admin.excelPasteSettings]),{dataDimensions:v,handleCreateExcelCells:g,handleDeleteExcelCellGroups:h}},ut=()=>{var Q,ee,te,se,ae,ne,le,re,oe,ie,ce,de;const{textObjects:t,imageObjects:n,drawObjects:s,floorImage:r,addTextObject:l,addImageObject:m,updateTextObject:d,updateImageObject:j,setFloorImage:v,deleteTextObject:g,deleteImageObject:h,settings:a,updateSettings:o,initializeFirebaseListeners:i,isLoading:x}=Z(),{currentTool:N,setCurrentTool:A,selectedObjectId:b,setSelectedObjectId:k}=Y(),{isSettingsExpanded:c,isExcelPasteExpanded:y,isDataManagementExpanded:R,excelPasteData:$,showPreview:T,colorMode:F,updateTimerRef:I,setExcelPasteData:L,setShowPreview:S,setColorMode:M,toggleSettings:J,toggleExcelPaste:V,toggleDataManagement:pe,clearUpdateTimer:q}=ct(),z={admin:{autoToolSwitch:((Q=a==null?void 0:a.admin)==null?void 0:Q.autoToolSwitch)??!0,gridVisible:((ee=a==null?void 0:a.admin)==null?void 0:ee.gridVisible)??!0,gridSize:((te=a==null?void 0:a.admin)==null?void 0:te.gridSize)??32,gridSnapEnabled:((se=a==null?void 0:a.admin)==null?void 0:se.gridSnapEnabled)??!1,defaultFontSize:((ae=a==null?void 0:a.admin)==null?void 0:ae.defaultFontSize)??16,defaultBoxWidth:((ne=a==null?void 0:a.admin)==null?void 0:ne.defaultBoxWidth)??200,defaultBoxHeight:((le=a==null?void 0:a.admin)==null?void 0:le.defaultBoxHeight)??60,objectCreationPosition:((re=a==null?void 0:a.admin)==null?void 0:re.objectCreationPosition)??{x:260,y:950},defaultCheckboxSettings:((oe=a==null?void 0:a.admin)==null?void 0:oe.defaultCheckboxSettings)??{checkedColor:"#22c55e",uncheckedColor:"#f3f4f6",checkedBackgroundColor:"#ffffff",uncheckedBackgroundColor:"#ffffff",checkedBackgroundOpacity:1,uncheckedBackgroundOpacity:1},excelPasteSettings:((ie=a==null?void 0:a.admin)==null?void 0:ie.excelPasteSettings)??{startPosition:{x:100,y:100},cellWidth:120,cellHeight:40,fontSize:14,fontColor:"#000000",backgroundColor:"transparent",maxRows:50,maxCols:50}},view:{virtualKeyboardEnabled:((ce=a==null?void 0:a.view)==null?void 0:ce.virtualKeyboardEnabled)??!0,touchMode:((de=a==null?void 0:a.view)==null?void 0:de.touchMode)??!0}},E=b?t.find(u=>u.id===b)||n.find(u=>u.id===b):null,fe=f.useCallback((u,p)=>{I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{d(u,p)},300)},[d]),je=f.useCallback((u,p)=>{I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{j(u,p)},300)},[j]),ye=f.useCallback(async u=>{if(E&&"text"in E){const p=E.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await d(E.id,{textStyle:{...p,...u}})}},[E,d]),we=f.useCallback(async u=>{if(E&&"text"in E){const p=E.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};await d(E.id,{boxStyle:{...p,...u}})}},[E,d]),{handleColorSelect:ve}=dt({selectedObject:E,colorMode:F,updateTextStyle:ye,updateBoxStyle:we}),Ce=f.useCallback(async u=>await l(u),[l]),{handleCreateExcelCells:Ne,handleDeleteExcelCellGroups:ke}=bt({excelPasteData:$,showPreview:T,safeSettings:z,textObjects:t,addTextObject:Ce,deleteTextObject:g,onDataChange:L,onPreviewChange:S}),Pe=be(E,F),{getSelectedCount:Se,clearSelection:ze}=O.getState(),Fe=Se(),Ee=f.useCallback(async()=>{const{x:u,y:p}=z.admin.objectCreationPosition,w={x:u,y:p,width:z.admin.defaultBoxWidth,height:z.admin.defaultBoxHeight,text:"ìƒˆ í…ìŠ¤íŠ¸",fontSize:z.admin.defaultFontSize,textStyle:{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0},permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,hasCheckbox:!1,checkboxChecked:!1,checkboxCheckedColor:"#22c55e",checkboxUncheckedColor:"#f3f4f6",isEditing:!1,lastModified:Date.now()};try{await l(w)}catch(P){console.error("í…ìŠ¤íŠ¸ ê°ì²´ ìƒì„± ì‹¤íŒ¨:",P)}},[l,z]),Ae=f.useCallback(async()=>{const{x:u,y:p}=z.admin.objectCreationPosition,{checkedColor:w,uncheckedColor:P,checkedBackgroundColor:C,uncheckedBackgroundColor:G,checkedBackgroundOpacity:U,uncheckedBackgroundOpacity:X}=z.admin.defaultCheckboxSettings,_={x:u,y:p,width:z.admin.defaultBoxWidth,height:z.admin.defaultBoxHeight,text:"ìƒˆ ì²´í¬ë°•ìŠ¤",fontSize:z.admin.defaultFontSize,textStyle:{color:"#000000",bold:!0,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:1,borderRadius:8},permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,hasCheckbox:!0,checkboxChecked:!1,checkboxCheckedColor:w,checkboxUncheckedColor:P,checkedBackgroundColor:C,uncheckedBackgroundColor:G,checkedBackgroundOpacity:U,uncheckedBackgroundOpacity:X,isEditing:!1,lastModified:Date.now()};try{await l(_)}catch(He){console.error("ì²´í¬ë°•ìŠ¤ ê°ì²´ ìƒì„± ì‹¤íŒ¨:",He)}},[l,z]),Te=f.useCallback(async()=>{try{const u=await mt("image/*");if(!u)return;const p=await xe(u),{width:w,height:P}=await xt(p),{width:C,height:G}=ht(w,P,200),{x:U,y:X}=z.admin.objectCreationPosition,_={x:U,y:X,width:C,height:G,src:p,permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,maintainAspectRatio:!0,lastModified:Date.now()};await m(_)}catch(u){console.error("ì´ë¯¸ì§€ ê°ì²´ ìƒì„± ì‹¤íŒ¨:",u)}},[m,z]),$e=f.useCallback(async()=>{if(!b)return;const u=_e(t,n);if(t.find(P=>P.id===b)){await d(b,{zIndex:u+1});return}n.find(P=>P.id===b)&&await j(b,{zIndex:u+1})},[b,t,n,d,j]),Ie=f.useCallback(async()=>{if(!b)return;const u=[...t,...n].find(C=>C.id===b);if(!u)return;const p=Ye(u.zIndex||0,t,n);if(p===null)return;if(t.find(C=>C.id===b)){await d(b,{zIndex:p+1});return}n.find(C=>C.id===b)&&await j(b,{zIndex:p+1})},[b,t,n,d,j]),Me=f.useCallback(async()=>{if(!b)return;const u=[...t,...n].find(C=>C.id===b);if(!u)return;const p=qe(u.zIndex||0,t,n);if(p===null)return;if(t.find(C=>C.id===b)){await d(b,{zIndex:p-1});return}n.find(C=>C.id===b)&&await j(b,{zIndex:p-1})},[b,t,n,d,j]),Be=f.useCallback(async()=>{if(!b)return;const u=Ke(t,n),p=Math.max(1,u-1);if(t.find(C=>C.id===b)){await d(b,{zIndex:p});return}n.find(C=>C.id===b)&&await j(b,{zIndex:p})},[b,t,n,d,j]),De=f.useCallback(async()=>{if(!b)return;const u=t.find(w=>w.id===b);if(u){const w={...u,x:u.x+20,y:u.y+20,isEditing:!1};delete w.id,await l(w);return}const p=n.find(w=>w.id===b);if(p){const w={...p,x:p.x+20,y:p.y+20};delete w.id,await m(w)}},[b,t,n,l,m]),We=f.useCallback(async()=>{var w,P;if(!b)return;const u=t.find(C=>C.id===b);if(u&&((w=u.permissions)!=null&&w.deletable)){await g(b),k(null);return}const p=n.find(C=>C.id===b);p&&((P=p.permissions)!=null&&P.deletable)&&(await h(b),k(null))},[b,t,n,g,h,k]),Re=f.useCallback(async u=>{var w;const p=(w=u.target.files)==null?void 0:w[0];if(p)try{const P=await xe(p);await v({path:P})}catch(P){console.error("ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:",P)}},[v]),Le=f.useCallback(()=>{S(!T);const u=new CustomEvent("excel-preview-update",{detail:{data:$,show:!T}});window.dispatchEvent(u)},[T,$,S]);return f.useEffect(()=>()=>{q()},[q]),x||!a?e.jsx("div",{className:"w-64 h-full bg-white border-r border-gray-200 p-4 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"ì„¤ì • ë¡œë“œ ì¤‘..."})}):e.jsxs("div",{className:"h-full flex flex-col overflow-hidden bg-gradient-to-b from-slate-50 to-slate-100",onClick:u=>{u.stopPropagation();const p=u.target;if(!Qe(p)){const w=document.activeElement;w&&et(w)&&w.blur()}},children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-gradient-to-r from-pink-200 to-purple-200",children:e.jsxs("h1",{className:"text-lg font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ› ï¸"}),"ê´€ë¦¬ìž ë„êµ¬"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(tt,{currentTool:N,onToolSelect:A,onCreateText:Ee,onCreateCheckbox:Ae,onCreateImage:Te}),e.jsx(st,{isExpanded:y,onToggle:V,excelPasteData:$,showPreview:T,safeSettings:z,onDataChange:L,onPreviewToggle:Le,onCreateCells:Ne,onDeleteCellGroups:ke,updateSettings:o}),E&&!Xe(E)&&Fe===0&&e.jsx(lt,{selectedObject:E,colorMode:F,onColorModeChange:M,onColorSelect:ve,onUpdateTextObject:fe,onUpdateImageObject:je,onDuplicate:De,onDelete:We,onBringToFront:$e,onBringForward:Ie,onSendBackward:Me,onSendToBack:Be,getCurrentColor:()=>Pe}),e.jsx(rt,{textObjects:t,colorMode:F,onColorModeChange:M,onUpdateTextObject:d,clearCellSelection:ze}),e.jsx(ot,{isExpanded:R,onToggle:pe,textObjects:t,imageObjects:n,drawObjects:s,floorImage:r,settings:a,initializeFirebaseListeners:i}),e.jsx(it,{isExpanded:c,onToggle:J,safeSettings:z,updateSettings:o,onImageUpload:Re})]})})]})},ge=Oe.memo(()=>{const{zoom:t,setZoom:n,fitToWindow:s}=Y(),r=f.useCallback(()=>{n(Math.min(t*1.2,5))},[t,n]),l=f.useCallback(()=>{n(Math.max(t/1.2,.05))},[t,n]),m=f.useCallback(()=>{s()},[s]),d=f.useCallback(()=>{n(1)},[n]);return e.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-2 z-50",children:[e.jsx("button",{onClick:r,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-lg font-semibold",title:"í™•ëŒ€ (Ctrl + íœ  ìœ„ ë˜ëŠ” Ctrl + +)",children:"+"}),e.jsx("button",{onClick:l,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-lg font-semibold",title:"ì¶•ì†Œ (Ctrl + íœ  ì•„ëž˜ ë˜ëŠ” Ctrl + -)",children:"-"}),e.jsx("button",{onClick:d,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-xs font-semibold",title:"100% í¬ê¸°",children:"1:1"}),e.jsx("button",{onClick:m,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-xs font-semibold",title:"ì°½ë§žì¶¤",children:"âŒ‚"})]})});ge.displayName="ZoomControls";const gt=()=>{const{currentTool:t}=Y(),{penColor:n,penWidth:s,usePerfectFreehand:r,defaultColors:l,setPenColor:m,setPenWidth:d,setUsePerfectFreehand:j}=Ze();if(t!=="pen"&&t!=="eraser")return null;const v=[2,4,6,8,12];return e.jsx("div",{className:"absolute left-4 top-20 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50",style:{minWidth:"280px"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:t==="pen"?"í•„ê¸° ì„¤ì •":"ì§€ìš°ê°œ ì„¤ì •"}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"ìƒ‰ìƒ"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:l.map((g,h)=>e.jsx("button",{className:`w-8 h-8 rounded border-2 ${n===g?"border-blue-500 border-4":"border-gray-300"}`,style:{backgroundColor:g},onClick:()=>m(g),title:g},h))})]}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"êµµê¸°"}),e.jsx("div",{className:"flex gap-2",children:v.map(g=>e.jsxs("button",{className:`px-3 py-2 rounded text-xs ${s===g?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>d(g),children:[g,"px"]},g))})]}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"ë Œë”ë§ í’ˆì§ˆ"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:g=>j(g.target.checked),className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-700",children:"ê³ í’ˆì§ˆ ë Œë”ë§ (Perfect Freehand)"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r?"âœ¨ ì••ë ¥ ê°ì§€ ë° ë¶€ë“œëŸ¬ìš´ ê³¡ì„  í™œì„±í™”":"ðŸ“ ê¸°ë³¸ ì„  ë Œë”ë§ (ë¹ ë¥¸ ì„±ëŠ¥)"})]})]})})},yt=()=>{const{initializeFirebaseListeners:t,initializePasswords:n}=Z();return f.useEffect(()=>((async()=>{await Ve(),t(),await n()})(),()=>{const{cleanupFirebaseListeners:r}=Z.getState();r()}),[t]),e.jsxs("div",{className:"w-screen h-screen overflow-hidden flex",children:[e.jsx("div",{className:"w-72 h-full bg-slate-100/95 backdrop-blur-sm shadow-xl border-r border-slate-200",children:e.jsx(ut,{})}),e.jsxs("main",{className:"flex-1 h-full relative",children:[e.jsx(Je,{isViewPage:!1}),e.jsx(gt,{})]}),e.jsx(ge,{})]})};export{yt as default};
