import{j as e,r as p,R as Me}from"./index-CO-S4vH9.js";import{u as ne,a as G,b as X,c as Be,C as We,s as Re}from"./Canvas-DipliISV.js";const oe=t=>t.trim()?t.split(`
`).filter(s=>s.trim()!=="").map(s=>s.split("	")):[],ie=["#000000","#ffffff","#cccccc","#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffa500","#800080"],De=[{id:"select",label:"선택",icon:"👆"},{id:"text",label:"텍스트",icon:"📝"},{id:"checkbox",label:"체크",icon:"☑️"},{id:"image",label:"이미지",icon:"🖼️"},{id:"pen",label:"필기",icon:"✏️"},{id:"eraser",label:"지우개",icon:"🧽"}],B=t=>t&&typeof t.hasCheckbox<"u",$e=t=>t&&typeof t.src<"u",He=t=>t&&"cellType"in t&&t.cellType==="cell",re=(t,l)=>{var s,n,a;if(!t||!B(t))return"#000000";switch(l){case"text":return((s=t.textStyle)==null?void 0:s.color)||"#000000";case"background":return((n=t.boxStyle)==null?void 0:n.backgroundColor)||"transparent";case"border":return((a=t.boxStyle)==null?void 0:a.borderColor)||"#000000";default:return"#000000"}},Ze=(t,l)=>{const s=[...t,...l];return Math.max(...s.map(n=>n.zIndex||0))},Le=(t,l)=>{const s=[...t,...l];return Math.min(...s.map(n=>n.zIndex||0))},Ve=(t,l,s)=>{const a=[...l,...s].filter(o=>(o.zIndex||0)>t);return a.length===0?null:Math.min(...a.map(o=>o.zIndex||0))},Ge=(t,l,s)=>{const a=[...l,...s].filter(o=>(o.zIndex||0)<t);return a.length===0?null:Math.max(...a.map(o=>o.zIndex||0))},ce=t=>{const l=oe(t);if(l.length===0)return{rows:0,cols:0};const s=l.length,n=Math.max(...l.map(a=>a.length));return{rows:s,cols:n}},Xe=t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable||t.closest("input, textarea, [contenteditable]")!==null,_e=t=>t.hasAttribute("data-canvas-container")||t.tabIndex===0&&t.tagName==="DIV",Ke=({currentTool:t,onToolSelect:l,onCreateText:s,onCreateCheckbox:n,onCreateImage:a})=>{const o=g=>{switch(g){case"select":l("select");break;case"text":s();break;case"checkbox":n();break;case"image":a();break;case"pen":case"eraser":l(g);break}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"⚡"})," 메인 도구"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:De.map(g=>e.jsxs("button",{onClick:()=>o(g.id),className:`p-3 rounded-lg flex flex-col items-center gap-1 transition-all duration-200 border-2
              ${t===g.id?"bg-blue-500 text-white border-blue-600 shadow-lg scale-105":"bg-slate-50 hover:bg-slate-100 text-slate-700 border-slate-200 hover:border-slate-300"}`,children:[e.jsx("span",{className:"text-2xl",children:g.icon}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]},g.id))})]})},Ye=({isExpanded:t,onToggle:l,excelPasteData:s,showPreview:n,safeSettings:a,onDataChange:o,onPreviewToggle:g,onCreateCells:y,onDeleteCellGroups:N,updateSettings:r})=>{const x=ce(s),m=i=>{o(i);const b=new CustomEvent("excel-preview-update",{detail:{data:i,show:!!i.trim()}});window.dispatchEvent(b)};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("button",{onClick:l,className:"w-full p-4 flex items-center justify-between text-sm font-bold text-slate-700 hover:bg-slate-50 rounded-t-xl transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📊"})," 엑셀 데이터 입력"]}),e.jsx("span",{className:`text-slate-400 transition-transform duration-200 ${t?"rotate-180":""}`,children:"▼"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-200 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"데이터 붙여넣기"}),e.jsx("textarea",{value:s,onChange:i=>m(i.target.value),onFocus:i=>i.stopPropagation(),onClick:i=>i.stopPropagation(),placeholder:"엑셀에서 복사한 데이터를 붙여넣으세요...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-xs resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s?`${x.rows}행 × ${x.cols}열`:"데이터 없음"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"X 좌표"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,x:Math.max(0,a.admin.excelPasteSettings.startPosition.x-10)}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"◀"}),e.jsx("input",{type:"number",value:a.admin.excelPasteSettings.startPosition.x,onChange:i=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,x:parseInt(i.target.value)||0}}}),onFocus:i=>i.stopPropagation(),onClick:i=>i.stopPropagation(),className:"w-16 px-1 py-1 border border-slate-300 rounded text-xs text-center"}),e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,x:a.admin.excelPasteSettings.startPosition.x+10}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"▶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"Y 좌표"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,y:Math.max(0,a.admin.excelPasteSettings.startPosition.y-10)}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"▲"}),e.jsx("input",{type:"number",value:a.admin.excelPasteSettings.startPosition.y,onChange:i=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,y:parseInt(i.target.value)||0}}}),onFocus:i=>i.stopPropagation(),onClick:i=>i.stopPropagation(),className:"w-16 px-1 py-1 border border-slate-300 rounded text-xs text-center"}),e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,startPosition:{...a.admin.excelPasteSettings.startPosition,y:a.admin.excelPasteSettings.startPosition.y+10}}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs font-mono",children:"▼"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"셀 너비"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,cellWidth:Math.max(20,a.admin.excelPasteSettings.cellWidth-1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"◀"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[a.admin.excelPasteSettings.cellWidth,"px"]}),e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,cellWidth:Math.min(300,a.admin.excelPasteSettings.cellWidth+1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"셀 높이"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,cellHeight:Math.max(20,a.admin.excelPasteSettings.cellHeight-1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[a.admin.excelPasteSettings.cellHeight,"px"]}),e.jsx("button",{onClick:()=>r("admin",{excelPasteSettings:{...a.admin.excelPasteSettings,cellHeight:Math.min(100,a.admin.excelPasteSettings.cellHeight+1)}}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:!s.trim(),className:"flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white rounded-lg text-sm font-medium transition-colors",children:"📋 셀 생성"}),e.jsxs("button",{onClick:g,disabled:!s.trim(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white rounded-lg text-sm font-medium transition-colors",children:["👁️ ",n?"숨김":"미리보기"]})]}),e.jsx("button",{onClick:N,className:"w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",title:"생성된 모든 엑셀 셀 그룹을 삭제합니다",children:"🗑️ 엑셀 셀 그룹 삭제"})]})]})]})},qe=({colorMode:t,currentColor:l,onColorModeChange:s,onColorSelect:n,showTransparent:a=!1})=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"색상"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-3",children:[e.jsx("button",{onClick:()=>s("text"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="text"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"텍스트"}),e.jsx("button",{onClick:()=>s("background"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="background"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"배경"}),e.jsx("button",{onClick:()=>s("border"),className:`px-2 py-2 rounded text-xs transition-colors ${t==="border"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"테두리"})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[a&&e.jsx("button",{onClick:()=>n("transparent"),className:`w-8 h-8 rounded border-2 transition-all ${l==="transparent"?"border-blue-500 border-2 shadow-md":"border-slate-300 hover:border-slate-400"}`,style:{backgroundColor:"white",backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"8px 8px",backgroundPosition:"0 0, 0 4px, 4px -4px, -4px 0px"},title:"투명"}),ie.map((o,g)=>{const y=l===o;return e.jsx("button",{onClick:()=>n(o),className:`w-8 h-8 rounded border-2 transition-all ${y?"border-blue-500 border-2 shadow-md":"border-slate-300 hover:border-slate-400"}`,style:{backgroundColor:o},title:o},g)})]})]}),Je=({onDuplicate:t,onDelete:l,onBringToFront:s,onBringForward:n,onSendBackward:a,onSendToBack:o})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,className:"flex-1 px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-medium transition-colors",children:"📋 복사"}),e.jsx("button",{onClick:l,className:"flex-1 px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors",children:"🗑️ 삭제"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"레이어 순서"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("button",{onClick:s,className:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs font-medium transition-colors",title:"맨 위로",children:"⬆⬆"}),e.jsx("button",{onClick:n,className:"px-2 py-1 bg-blue-400 hover:bg-blue-500 text-white rounded text-xs font-medium transition-colors",title:"위로",children:"⬆"}),e.jsx("button",{onClick:a,className:"px-2 py-1 bg-purple-400 hover:bg-purple-500 text-white rounded text-xs font-medium transition-colors",title:"아래로",children:"⬇"}),e.jsx("button",{onClick:o,className:"px-2 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium transition-colors",title:"맨 아래로",children:"⬇⬇"})]})]})]}),Qe=({selectedObject:t,colorMode:l,onColorModeChange:s,onColorSelect:n,onUpdateTextObject:a,onUpdateImageObject:o,onDuplicate:g,onDelete:y,onBringToFront:N,onBringForward:r,onSendBackward:x,onSendToBack:m,getCurrentColor:i})=>{var E,I,S;if(!t)return null;const b=i(),c=d=>{if(B(t)){const j=t.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};a(t.id,{textStyle:{...j,...d}})}},F=d=>{if(B(t)){const j=t.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};a(t.id,{boxStyle:{...j,...d}})}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"✏️"})," 선택된 객체 편집"]}),B(t)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"텍스트"}),e.jsx("textarea",{value:t.text,onChange:d=>a(t.id,{text:d.target.value}),onFocus:d=>d.stopPropagation(),onClick:d=>d.stopPropagation(),className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"폰트 크기"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(t.id,{fontSize:Math.max(8,t.fontSize-2)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded border",children:[t.fontSize,"px"]}),e.jsx("button",{onClick:()=>a(t.id,{fontSize:Math.min(72,t.fontSize+2)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"})]})]}),e.jsx(qe,{colorMode:l,currentColor:b,onColorModeChange:s,onColorSelect:n,showTransparent:l==="background"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"텍스트 스타일"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{var d;return c({bold:!((d=t.textStyle)!=null&&d.bold)})},className:`px-3 py-1 rounded-lg text-xs transition-colors ${(E=t.textStyle)!=null&&E.bold?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"굵게"}),e.jsx("button",{onClick:()=>{var d;return c({italic:!((d=t.textStyle)!=null&&d.italic)})},className:`px-3 py-1 rounded-lg text-xs transition-colors ${(I=t.textStyle)!=null&&I.italic?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"기울임"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"텍스트 정렬"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"가로"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["left","center","right"].map(d=>{var j;return e.jsx("button",{onClick:()=>c({horizontalAlign:d}),className:`px-2 py-1 rounded text-xs transition-colors ${((j=t.textStyle)==null?void 0:j.horizontalAlign)===d?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:d==="left"?"◀":d==="center"?"●":"▶"},d)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"세로"}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["top","middle","bottom"].map(d=>{var j;return e.jsx("button",{onClick:()=>c({verticalAlign:d}),className:`px-2 py-1 rounded text-xs transition-colors ${((j=t.textStyle)==null?void 0:j.verticalAlign)===d?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:d==="top"?"▲":d==="middle"?"●":"▼"},d)})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"테두리 두께"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{var d;return F({borderWidth:Math.max(0,(((d=t.boxStyle)==null?void 0:d.borderWidth)||0)-1)})},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[((S=t.boxStyle)==null?void 0:S.borderWidth)||0,"px"]}),e.jsx("button",{onClick:()=>{var d;return F({borderWidth:Math.min(10,(((d=t.boxStyle)==null?void 0:d.borderWidth)||0)+1)})},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"})]})]})]}),$e(t)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:t.maintainAspectRatio||!1,onChange:d=>o(t.id,{maintainAspectRatio:d.target.checked}),className:"rounded"}),e.jsx("span",{children:"비율 유지"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"불투명도"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(t.id,{opacity:Math.max(.1,(t.opacity||1)-.1)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded",children:[Math.round((t.opacity||1)*100),"%"]}),e.jsx("button",{onClick:()=>o(t.id,{opacity:Math.min(1,(t.opacity||1)+.1)}),className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"크기"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 mb-1 block",children:"너비"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const d=Math.max(50,t.width-10),j=t.maintainAspectRatio?{width:d,height:d/(t.width/t.height)}:{width:d};o(t.id,j)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"◀"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-slate-50 py-1 rounded",children:Math.round(t.width)}),e.jsx("button",{onClick:()=>{const d=t.width+10,j=t.maintainAspectRatio?{width:d,height:d/(t.width/t.height)}:{width:d};o(t.id,j)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 mb-1 block",children:"높이"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const d=Math.max(30,t.height-10),j=t.maintainAspectRatio?{height:d,width:d*(t.width/t.height)}:{height:d};o(t.id,j)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-slate-50 py-1 rounded",children:Math.round(t.height)}),e.jsx("button",{onClick:()=>{const d=t.height+10,j=t.maintainAspectRatio?{height:d,width:d*(t.width/t.height)}:{height:d};o(t.id,j)},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"})]})]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-slate-200",children:e.jsx(Je,{onDuplicate:g,onDelete:y,onBringToFront:N,onBringForward:r,onSendBackward:x,onSendToBack:m})})]})},Ue=({textObjects:t,colorMode:l,onColorModeChange:s,onUpdateTextObject:n,clearCellSelection:a})=>{const{getSelectedCells:o,getSelectedCount:g}=ne.getState(),y=o(),N=g();if(N===0)return null;const r=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#008000","#000080","#800000","#008080","#C0C0C0","#FFFFE0","#F0F8FF"];return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx("span",{children:"📊"})," 선택된 엑셀 셀 (",N,"개)"]}),e.jsx("button",{onClick:a,className:"text-xs text-slate-500 hover:text-slate-700 bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded transition-colors",children:"선택 해제"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"폰트 크기"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{let x=72;for(const i of y){const b=t.find(c=>c.id===i);b&&b.cellType==="cell"&&(x=Math.min(x,b.fontSize))}const m=Math.max(8,x-2);for(const i of y){const b=t.find(c=>c.id===i);b&&b.cellType==="cell"&&await n(i,{fontSize:m})}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▼"}),e.jsx("span",{className:"flex-1 text-center text-sm font-mono bg-slate-50 py-1 rounded border",children:"일괄 변경"}),e.jsx("button",{onClick:async()=>{let x=8;for(const i of y){const b=t.find(c=>c.id===i);b&&b.cellType==="cell"&&(x=Math.min(x,b.fontSize))}const m=Math.min(72,x+2);for(const i of y){const b=t.find(c=>c.id===i);b&&b.cellType==="cell"&&await n(i,{fontSize:m})}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs",children:"▲"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"색상"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-3",children:[e.jsx("button",{onClick:()=>s("text"),className:`px-2 py-2 rounded text-xs transition-colors ${l==="text"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"텍스트"}),e.jsx("button",{onClick:()=>s("background"),className:`px-2 py-2 rounded text-xs transition-colors ${l==="background"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"배경"}),e.jsx("button",{onClick:()=>s("border"),className:`px-2 py-2 rounded text-xs transition-colors ${l==="border"?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"테두리"})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[l==="background"&&e.jsx("button",{onClick:async()=>{for(const x of y){const m=t.find(i=>i.id===x);if(m&&m.cellType==="cell"){const i=m.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};await n(x,{boxStyle:{...i,backgroundColor:"transparent"}})}}},className:"w-8 h-8 rounded border-2 border-gray-300 bg-white flex items-center justify-center hover:bg-gray-50 transition-colors",title:"투명",children:e.jsx("span",{className:"text-red-500 text-xs",children:"∅"})}),r.map(x=>e.jsx("button",{onClick:async()=>{for(const m of y){const i=t.find(b=>b.id===m);if(i&&i.cellType==="cell"){if(l==="text"){const b=i.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await n(m,{textStyle:{...b,color:x}})}else if(l==="background"){const b=i.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};await n(m,{boxStyle:{...b,backgroundColor:x}})}else if(l==="border"){const b=i.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};await n(m,{boxStyle:{...b,borderColor:x,borderWidth:1}})}}}},className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:x},title:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"텍스트 스타일"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{for(const x of y){const m=t.find(i=>i.id===x);if(m&&m.cellType==="cell"){const i=m.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await n(x,{textStyle:{...i,bold:!i.bold}})}}},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded text-xs font-bold transition-colors",children:"B"}),e.jsx("button",{onClick:async()=>{for(const x of y){const m=t.find(i=>i.id===x);if(m&&m.cellType==="cell"){const i=m.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await n(x,{textStyle:{...i,italic:!i.italic}})}}},className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded text-xs italic transition-colors",children:"I"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"정렬"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-2",children:["left","center","right"].map(x=>e.jsx("button",{onClick:async()=>{for(const m of y){const i=t.find(b=>b.id===m);if(i&&i.cellType==="cell"){const b=i.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await n(m,{textStyle:{...b,horizontalAlign:x}})}}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",children:x==="left"?"←":x==="center"?"↔":"→"},x))}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:["top","middle","bottom"].map(x=>e.jsx("button",{onClick:async()=>{for(const m of y){const i=t.find(b=>b.id===m);if(i&&i.cellType==="cell"){const b=i.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await n(m,{textStyle:{...b,verticalAlign:x}})}}},className:"px-2 py-1 bg-slate-100 hover:bg-slate-200 rounded text-xs transition-colors",children:x==="top"?"↑":x==="middle"?"↕":"↓"},x))})]})]})]})},Oe=({isExpanded:t,onToggle:l,safeSettings:s,updateSettings:n,onImageUpload:a})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("button",{onClick:l,className:"w-full p-4 flex items-center justify-between text-sm font-bold text-slate-700 hover:bg-slate-50 rounded-t-xl transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"⚙️"})," 설정"]}),e.jsx("span",{className:`text-slate-400 transition-transform duration-200 ${t?"rotate-180":""}`,children:"▼"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-200 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"🔲"})," 그리드"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.gridVisible,onChange:o=>n("admin",{gridVisible:o.target.checked}),className:"rounded"}),e.jsx("span",{children:"그리드 표시"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.gridSnapEnabled,onChange:o=>n("admin",{gridSnapEnabled:o.target.checked}),className:"rounded"}),e.jsx("span",{children:"그리드에 스냅"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"그리드 크기"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n("admin",{gridSize:Math.max(8,s.admin.gridSize-4)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-white py-1 rounded border",children:[s.admin.gridSize,"px"]}),e.jsx("button",{onClick:()=>n("admin",{gridSize:Math.min(64,s.admin.gridSize+4)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▲"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"📍"})," 객체 생성 위치"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"X 좌표"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const o=Math.max(0,s.admin.objectCreationPosition.x-20);n("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,x:o}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"◀"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:s.admin.objectCreationPosition.x}),e.jsx("button",{onClick:()=>{const o=s.admin.objectCreationPosition.x+20;n("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,x:o}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"Y 좌표"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{const o=Math.max(0,s.admin.objectCreationPosition.y-20);n("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,y:o}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▲"}),e.jsx("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:s.admin.objectCreationPosition.y}),e.jsx("button",{onClick:()=>{const o=s.admin.objectCreationPosition.y+20;n("admin",{objectCreationPosition:{...s.admin.objectCreationPosition,y:o}})},className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▼"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 mb-2 flex items-center gap-1",children:[e.jsx("span",{children:"🖼️"})," 배경 이미지"]}),e.jsxs("label",{className:"w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors cursor-pointer text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{children:"📁"}),e.jsx("span",{children:"이미지 업로드"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a,className:"hidden"})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 space-y-2",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-600 flex items-center gap-1",children:[e.jsx("span",{children:"🔧"})," 기타"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.admin.autoToolSwitch,onChange:o=>n("admin",{autoToolSwitch:o.target.checked}),className:"rounded"}),e.jsx("span",{children:"객체 생성 후 자동으로 선택 도구로 전환"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-1 block",children:"기본 폰트 크기"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n("admin",{defaultFontSize:Math.max(8,s.admin.defaultFontSize-2)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▼"}),e.jsxs("span",{className:"flex-1 text-center text-sm font-mono bg-white py-1 rounded border",children:[s.admin.defaultFontSize,"px"]}),e.jsx("button",{onClick:()=>n("admin",{defaultFontSize:Math.min(72,s.admin.defaultFontSize+2)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▲"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 mb-2 block",children:"기본 박스 크기"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"가로"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>n("admin",{defaultBoxWidth:Math.max(50,s.admin.defaultBoxWidth-10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"◀"}),e.jsxs("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:[s.admin.defaultBoxWidth,"px"]}),e.jsx("button",{onClick:()=>n("admin",{defaultBoxWidth:Math.min(500,s.admin.defaultBoxWidth+10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"세로"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>n("admin",{defaultBoxHeight:Math.max(30,s.admin.defaultBoxHeight-10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▲"}),e.jsxs("span",{className:"flex-1 text-center text-xs font-mono bg-white py-1 rounded border",children:[s.admin.defaultBoxHeight,"px"]}),e.jsx("button",{onClick:()=>n("admin",{defaultBoxHeight:Math.min(200,s.admin.defaultBoxHeight+10)}),className:"px-2 py-1 bg-white hover:bg-slate-100 rounded text-xs border",children:"▼"})]})]})]})]})]})]})]}),et=()=>{const[t,l]=p.useState(!1),[s,n]=p.useState(!1),[a,o]=p.useState(""),[g,y]=p.useState(!1),[N,r]=p.useState("text"),x=p.useRef(null);return{isSettingsExpanded:t,isExcelPasteExpanded:s,excelPasteData:a,showPreview:g,colorMode:N,updateTimerRef:x,setIsSettingsExpanded:l,setIsExcelPasteExpanded:n,setExcelPasteData:o,setShowPreview:y,setColorMode:r,toggleSettings:()=>l(!t),toggleExcelPaste:()=>n(!s),resetExcelData:()=>{o(""),y(!1)},clearUpdateTimer:()=>{x.current&&(clearTimeout(x.current),x.current=null)}}},tt=({selectedObject:t,colorMode:l,updateTextStyle:s,updateBoxStyle:n})=>{const a=p.useCallback(g=>{if(!(!t||!B(t)))switch(l){case"text":s({color:g});break;case"background":n({backgroundColor:g});break;case"border":n({borderColor:g});break}},[l,t,s,n]),o=re(t,l);return{colors:ie,currentColor:o,handleColorSelect:a,showTransparent:l==="background"}},ae=t=>new Promise((l,s)=>{const n=new FileReader;n.onload=a=>{var g;const o=(g=a.target)==null?void 0:g.result;l(o)},n.onerror=()=>{s(new Error("파일 읽기 실패"))},n.readAsDataURL(t)}),st=t=>new Promise((l,s)=>{const n=new Image;n.onload=()=>{l({width:n.naturalWidth,height:n.naturalHeight})},n.onerror=()=>{s(new Error("이미지 로드 실패"))},n.src=t}),lt=(t="image/*")=>new Promise(l=>{const s=document.createElement("input");s.type="file",s.accept=t,s.onchange=n=>{var o;const a=(o=n.target.files)==null?void 0:o[0];l(a||null)},s.click()}),at=(t,l,s=200)=>{const n=l/t,a=s*n;return{width:s,height:a}},V=(t,l)=>{const s=new CustomEvent("excel-preview-update",{detail:{data:t,show:l}});window.dispatchEvent(s)},nt=({excelPasteData:t,showPreview:l,safeSettings:s,textObjects:n,addTextObject:a,deleteTextObject:o,onDataChange:g,onPreviewChange:y})=>{const N=ce(t),r=p.useCallback(async()=>{var R;const m=oe(t);if(m.length===0){alert("붙여넣을 데이터가 없습니다.");return}const{startPosition:i,cellWidth:b,cellHeight:c,fontSize:F,fontColor:E,backgroundColor:I,maxRows:S=100,maxCols:d=50}=s.admin.excelPasteSettings,j=`excel-input-${Date.now()}`,z=[],A=Math.min(m.length,S),T=m.map(P=>P.length),W=T.length>0?Math.max(...T):0,M=Math.min(W,d);for(let P=0;P<A;P++)for(let C=0;C<M;C++){const w=((R=m[P])==null?void 0:R[C])||"",D={x:i.x+C*b,y:i.y+P*c,width:b,height:c,text:w,fontSize:F,textStyle:{color:E,bold:!1,italic:!1,horizontalAlign:"center",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:I,backgroundOpacity:1,borderColor:"#d1d5db",borderWidth:1,borderRadius:0},permissions:{editable:!0,movable:!1,resizable:!1,deletable:!1},zIndex:Date.now()+P*M+C,locked:!0,visible:!0,opacity:1,hasCheckbox:!1,checkboxChecked:!1,checkboxCheckedColor:"#22c55e",checkboxUncheckedColor:"#f3f4f6",isEditing:!1,lastModified:Date.now(),groupId:j,cellType:"cell",cellPosition:{row:P,col:C}};z.push(D)}try{for(const P of z)await a(P);alert(`${A}x${M} 셀이 생성되었습니다.`),g(""),y(!1),V("",!1)}catch(P){console.error("엑셀 셀 생성 실패:",P),alert("셀 생성 중 오류가 발생했습니다.")}},[t,s.admin.excelPasteSettings,a,g,y]),x=p.useCallback(async()=>{const m=n.filter(c=>c.groupId&&c.groupId.startsWith("excel-input-"));if(m.length===0){alert("삭제할 엑셀 셀이 없습니다.");return}const i=new Set(m.map(c=>c.groupId)).size,b=`${i}개의 엑셀 그룹 (총 ${m.length}개 셀)을 삭제하시겠습니까?`;if(confirm(b))try{for(const c of m)await o(c.id);alert(`${i}개 그룹 (${m.length}개 셀)이 삭제되었습니다.`)}catch(c){console.error("엑셀 셀 삭제 실패:",c),alert("셀 삭제 중 오류가 발생했습니다.")}},[n,o]);return p.useEffect(()=>{l&&t.trim()?V(t,!0):V("",!1)},[l,t,s.admin.excelPasteSettings]),{dataDimensions:N,handleCreateExcelCells:r,handleDeleteExcelCellGroups:x}},ot=()=>{var _,K,Y,q,J,Q,U,O,ee,te,se,le;const{textObjects:t,imageObjects:l,addTextObject:s,addImageObject:n,updateTextObject:a,updateImageObject:o,setFloorImage:g,deleteTextObject:y,deleteImageObject:N,settings:r,updateSettings:x,isLoading:m}=G(),{currentTool:i,setCurrentTool:b,selectedObjectId:c,setSelectedObjectId:F}=X(),{isSettingsExpanded:E,isExcelPasteExpanded:I,excelPasteData:S,showPreview:d,colorMode:j,updateTimerRef:z,setExcelPasteData:A,setShowPreview:T,setColorMode:W,toggleSettings:M,toggleExcelPaste:R,clearUpdateTimer:P}=et(),C={admin:{autoToolSwitch:((_=r==null?void 0:r.admin)==null?void 0:_.autoToolSwitch)??!0,gridVisible:((K=r==null?void 0:r.admin)==null?void 0:K.gridVisible)??!0,gridSize:((Y=r==null?void 0:r.admin)==null?void 0:Y.gridSize)??32,gridSnapEnabled:((q=r==null?void 0:r.admin)==null?void 0:q.gridSnapEnabled)??!1,defaultFontSize:((J=r==null?void 0:r.admin)==null?void 0:J.defaultFontSize)??16,defaultBoxWidth:((Q=r==null?void 0:r.admin)==null?void 0:Q.defaultBoxWidth)??200,defaultBoxHeight:((U=r==null?void 0:r.admin)==null?void 0:U.defaultBoxHeight)??60,objectCreationPosition:((O=r==null?void 0:r.admin)==null?void 0:O.objectCreationPosition)??{x:260,y:950},defaultCheckboxSettings:((ee=r==null?void 0:r.admin)==null?void 0:ee.defaultCheckboxSettings)??{checkedColor:"#22c55e",uncheckedColor:"#f3f4f6",checkedBackgroundColor:"#ffffff",uncheckedBackgroundColor:"#ffffff",checkedBackgroundOpacity:1,uncheckedBackgroundOpacity:1},excelPasteSettings:((te=r==null?void 0:r.admin)==null?void 0:te.excelPasteSettings)??{startPosition:{x:100,y:100},cellWidth:120,cellHeight:40,fontSize:14,fontColor:"#000000",backgroundColor:"transparent",maxRows:50,maxCols:50}},view:{virtualKeyboardEnabled:((se=r==null?void 0:r.view)==null?void 0:se.virtualKeyboardEnabled)??!0,touchMode:((le=r==null?void 0:r.view)==null?void 0:le.touchMode)??!0}},w=c?t.find(h=>h.id===c)||l.find(h=>h.id===c):null,D=p.useCallback((h,u)=>{z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{a(h,u)},300)},[a]),xe=p.useCallback((h,u)=>{z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{o(h,u)},300)},[o]),he=p.useCallback(async h=>{if(w&&"text"in w){const u=w.textStyle||{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"};await a(w.id,{textStyle:{...u,...h}})}},[w,a]),me=p.useCallback(async h=>{if(w&&"text"in w){const u=w.boxStyle||{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0};await a(w.id,{boxStyle:{...u,...h}})}},[w,a]),{handleColorSelect:be}=tt({selectedObject:w,colorMode:j,updateTextStyle:he,updateBoxStyle:me}),ue=p.useCallback(async h=>await s(h),[s]),{handleCreateExcelCells:ge,handleDeleteExcelCellGroups:pe}=nt({excelPasteData:S,showPreview:d,safeSettings:C,textObjects:t,addTextObject:ue,deleteTextObject:y,onDataChange:A,onPreviewChange:T}),fe=re(w,j),{getSelectedCount:ye,clearSelection:je}=ne.getState(),Ce=ye(),ke=p.useCallback(async()=>{const{x:h,y:u}=C.admin.objectCreationPosition,f={x:h,y:u,width:C.admin.defaultBoxWidth,height:C.admin.defaultBoxHeight,text:"새 텍스트",fontSize:C.admin.defaultFontSize,textStyle:{color:"#000000",bold:!1,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:0,borderRadius:0},permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,hasCheckbox:!1,checkboxChecked:!1,checkboxCheckedColor:"#22c55e",checkboxUncheckedColor:"#f3f4f6",isEditing:!1,lastModified:Date.now()};try{await s(f)}catch(v){console.error("텍스트 객체 생성 실패:",v)}},[s,C]),ve=p.useCallback(async()=>{const{x:h,y:u}=C.admin.objectCreationPosition,{checkedColor:f,uncheckedColor:v,checkedBackgroundColor:k,uncheckedBackgroundColor:$,checkedBackgroundOpacity:H,uncheckedBackgroundOpacity:Z}=C.admin.defaultCheckboxSettings,L={x:h,y:u,width:C.admin.defaultBoxWidth,height:C.admin.defaultBoxHeight,text:"새 체크박스",fontSize:C.admin.defaultFontSize,textStyle:{color:"#000000",bold:!0,italic:!1,horizontalAlign:"left",verticalAlign:"middle",fontFamily:"Arial"},boxStyle:{backgroundColor:"transparent",backgroundOpacity:1,borderColor:"#000000",borderWidth:1,borderRadius:8},permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,hasCheckbox:!0,checkboxChecked:!1,checkboxCheckedColor:f,checkboxUncheckedColor:v,checkedBackgroundColor:k,uncheckedBackgroundColor:$,checkedBackgroundOpacity:H,uncheckedBackgroundOpacity:Z,isEditing:!1,lastModified:Date.now()};try{await s(L)}catch(Ae){console.error("체크박스 객체 생성 실패:",Ae)}},[s,C]),we=p.useCallback(async()=>{try{const h=await lt("image/*");if(!h)return;const u=await ae(h),{width:f,height:v}=await st(u),{width:k,height:$}=at(f,v,200),{x:H,y:Z}=C.admin.objectCreationPosition,L={x:H,y:Z,width:k,height:$,src:u,permissions:{editable:!0,movable:!0,resizable:!0,deletable:!0},zIndex:Date.now(),locked:!1,visible:!0,opacity:1,maintainAspectRatio:!0,lastModified:Date.now()};await n(L)}catch(h){console.error("이미지 객체 생성 실패:",h)}},[n,C]),Ne=p.useCallback(async()=>{if(!c)return;const h=Ze(t,l);if(t.find(v=>v.id===c)){await a(c,{zIndex:h+1});return}l.find(v=>v.id===c)&&await o(c,{zIndex:h+1})},[c,t,l,a,o]),Pe=p.useCallback(async()=>{if(!c)return;const h=[...t,...l].find(k=>k.id===c);if(!h)return;const u=Ve(h.zIndex||0,t,l);if(u===null)return;if(t.find(k=>k.id===c)){await a(c,{zIndex:u+1});return}l.find(k=>k.id===c)&&await o(c,{zIndex:u+1})},[c,t,l,a,o]),Se=p.useCallback(async()=>{if(!c)return;const h=[...t,...l].find(k=>k.id===c);if(!h)return;const u=Ge(h.zIndex||0,t,l);if(u===null)return;if(t.find(k=>k.id===c)){await a(c,{zIndex:u-1});return}l.find(k=>k.id===c)&&await o(c,{zIndex:u-1})},[c,t,l,a,o]),ze=p.useCallback(async()=>{if(!c)return;const h=Le(t,l),u=Math.max(1,h-1);if(t.find(k=>k.id===c)){await a(c,{zIndex:u});return}l.find(k=>k.id===c)&&await o(c,{zIndex:u})},[c,t,l,a,o]),Fe=p.useCallback(async()=>{if(!c)return;const h=t.find(f=>f.id===c);if(h){const f={...h,x:h.x+20,y:h.y+20,isEditing:!1};delete f.id,await s(f);return}const u=l.find(f=>f.id===c);if(u){const f={...u,x:u.x+20,y:u.y+20};delete f.id,await n(f)}},[c,t,l,s,n]),Ee=p.useCallback(async()=>{var f,v;if(!c)return;const h=t.find(k=>k.id===c);if(h&&((f=h.permissions)!=null&&f.deletable)){await y(c),F(null);return}const u=l.find(k=>k.id===c);u&&((v=u.permissions)!=null&&v.deletable)&&(await N(c),F(null))},[c,t,l,y,N,F]),Ie=p.useCallback(async h=>{var f;const u=(f=h.target.files)==null?void 0:f[0];if(u)try{const v=await ae(u);await g({path:v})}catch(v){console.error("배경 이미지 업로드 실패:",v)}},[g]),Te=p.useCallback(()=>{T(!d);const h=new CustomEvent("excel-preview-update",{detail:{data:S,show:!d}});window.dispatchEvent(h)},[d,S,T]);return p.useEffect(()=>()=>{P()},[P]),m||!r?e.jsx("div",{className:"w-64 h-full bg-white border-r border-gray-200 p-4 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"설정 로드 중..."})}):e.jsxs("div",{className:"h-full flex flex-col overflow-hidden bg-gradient-to-b from-slate-50 to-slate-100",onClick:h=>{h.stopPropagation();const u=h.target;if(!Xe(u)){const f=document.activeElement;f&&_e(f)&&f.blur()}},children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-gradient-to-r from-pink-200 to-purple-200",children:e.jsxs("h1",{className:"text-lg font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("span",{children:"🛠️"}),"관리자 도구"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Ke,{currentTool:i,onToolSelect:b,onCreateText:ke,onCreateCheckbox:ve,onCreateImage:we}),e.jsx(Ye,{isExpanded:I,onToggle:R,excelPasteData:S,showPreview:d,safeSettings:C,onDataChange:A,onPreviewToggle:Te,onCreateCells:ge,onDeleteCellGroups:pe,updateSettings:x}),w&&!He(w)&&Ce===0&&e.jsx(Qe,{selectedObject:w,colorMode:j,onColorModeChange:W,onColorSelect:be,onUpdateTextObject:D,onUpdateImageObject:xe,onDuplicate:Fe,onDelete:Ee,onBringToFront:Ne,onBringForward:Pe,onSendBackward:Se,onSendToBack:ze,getCurrentColor:()=>fe}),e.jsx(Ue,{textObjects:t,colorMode:j,onColorModeChange:W,onUpdateTextObject:D,clearCellSelection:je}),e.jsx(Oe,{isExpanded:E,onToggle:M,safeSettings:C,updateSettings:x,onImageUpload:Ie})]})})]})},de=Me.memo(()=>{const{zoom:t,setZoom:l,fitToWindow:s}=X(),n=p.useCallback(()=>{l(Math.min(t*1.2,5))},[t,l]),a=p.useCallback(()=>{l(Math.max(t/1.2,.05))},[t,l]),o=p.useCallback(()=>{s()},[s]),g=p.useCallback(()=>{l(1)},[l]);return e.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-2 z-50",children:[e.jsx("button",{onClick:n,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-lg font-semibold",title:"확대 (Ctrl + 휠 위 또는 Ctrl + +)",children:"+"}),e.jsx("button",{onClick:a,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-lg font-semibold",title:"축소 (Ctrl + 휠 아래 또는 Ctrl + -)",children:"-"}),e.jsx("button",{onClick:g,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-xs font-semibold",title:"100% 크기",children:"1:1"}),e.jsx("button",{onClick:o,className:"w-10 h-10 bg-white border border-gray-300 rounded-lg shadow-md hover:shadow-lg transition-shadow flex items-center justify-center text-xs font-semibold",title:"창맞춤",children:"⌂"})]})});de.displayName="ZoomControls";const it=()=>{const{currentTool:t}=X(),{penColor:l,penWidth:s,usePerfectFreehand:n,defaultColors:a,setPenColor:o,setPenWidth:g,setUsePerfectFreehand:y}=Be();if(t!=="pen"&&t!=="eraser")return null;const N=[2,4,6,8,12];return e.jsx("div",{className:"absolute left-4 top-20 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50",style:{minWidth:"280px"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:t==="pen"?"필기 설정":"지우개 설정"}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"색상"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:a.map((r,x)=>e.jsx("button",{className:`w-8 h-8 rounded border-2 ${l===r?"border-blue-500 border-4":"border-gray-300"}`,style:{backgroundColor:r},onClick:()=>o(r),title:r},x))})]}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"굵기"}),e.jsx("div",{className:"flex gap-2",children:N.map(r=>e.jsxs("button",{className:`px-3 py-2 rounded text-xs ${s===r?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>g(r),children:[r,"px"]},r))})]}),t==="pen"&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"렌더링 품질"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:r=>y(r.target.checked),className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-700",children:"고품질 렌더링 (Perfect Freehand)"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:n?"✨ 압력 감지 및 부드러운 곡선 활성화":"📝 기본 선 렌더링 (빠른 성능)"})]})]})})},dt=()=>{const{initializeFirebaseListeners:t}=G();return p.useEffect(()=>((async()=>{await Re(),t()})(),()=>{const{cleanupFirebaseListeners:s}=G.getState();s()}),[t]),e.jsxs("div",{className:"w-screen h-screen overflow-hidden flex",children:[e.jsx("div",{className:"w-72 h-full bg-slate-100/95 backdrop-blur-sm shadow-xl border-r border-slate-200",children:e.jsx(ot,{})}),e.jsxs("main",{className:"flex-1 h-full relative",children:[e.jsx(We,{isViewPage:!1}),e.jsx(it,{})]}),e.jsx(de,{})]})};export{dt as default};
